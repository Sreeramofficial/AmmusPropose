<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ammu ‚Äî Happy Valentine's Day ‚ù§Ô∏è</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Great+Vibes&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: "Poppins", sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #ff758c, #ff7eb3);
        overflow: hidden;
        padding: env(safe-area-inset-top) env(safe-area-inset-right)
          env(safe-area-inset-bottom) env(safe-area-inset-left);
      }

      .card {
        background: white;
        padding: 36px 28px;
        border-radius: 22px;
        text-align: center;
        width: min(92vw, 420px);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.18);
        animation: fadeIn 1s ease;
      }

      h1 {
        font-family: "Great Vibes", cursive;
        font-size: clamp(30px, 6.5vw, 48px);
        color: #ff4d6d;
        margin-bottom: 8px;
        word-break: break-word;
      }

      p {
        font-size: clamp(14px, 3.5vw, 16px);
        color: #555;
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .buttons {
        display: flex;
        justify-content: center;
        gap: 12px;
      }

      button {
        border: none;
        padding: 12px 22px;
        font-size: 16px;
        border-radius: 30px;
        cursor: pointer;
        transition:
          transform 0.15s ease,
          background-color 0.15s ease;
        touch-action: manipulation;
      }

      .yes {
        background: #ff4d6d;
        color: #fff;
      }
      .yes:hover {
        transform: translateY(-2px);
        background: #e63e5c;
      }
      .no {
        background: #eee;
        color: #333;
        position: relative;
        transition:
          left 0.25s ease,
          top 0.25s ease,
          transform 0.12s ease;
        will-change: left, top, transform;
      }

      /* Disabled state for buttons */
      button:disabled,
      button[disabled] {
        opacity: 0.6;
        cursor: default;
        transform: none !important;
        pointer-events: none;
      }

      /* Mobile / small screens */
      @media (max-width: 480px) {
        body {
          padding: 12px;
        }
        .card {
          padding: 24px;
          border-radius: 18px;
        }
        .buttons {
          flex-direction: column;
          gap: 12px;
        }
        button {
          width: 100%;
          padding: 14px;
          font-size: 18px;
          border-radius: 12px;
        }
        .heart {
          font-size: 16px;
        }
        .success {
          font-size: 20px;
        }
      }

      .heart {
        position: absolute;
        color: #ff4d6d;
        animation: floatUp 4s linear infinite;
        font-size: 18px;
        pointer-events: none;
      }

      @media (prefers-reduced-motion: reduce) {
        .heart,
        .card {
          animation: none !important;
          transition: none !important;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes floatUp {
        0% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateY(-600px) scale(1.4);
          opacity: 0;
        }
      }

      .success {
        font-size: 22px;
        color: #ff4d6d;
        font-weight: 600;
        margin-top: 16px;
        display: none;
      }

      /* Entry gate (name + DOB) */
      #gate {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
      }
      .gate-form {
        background: #fff;
        padding: 22px;
        border-radius: 16px;
        width: min(420px, 100%);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        text-align: center;
      }
      .gate-form h2 {
        font-size: 20px;
        color: #ff4d6d;
        margin-bottom: 12px;
      }
      .gate-form input {
        width: 100%;
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 8px;
        border: 1px solid #eee;
        font-size: 16px;
      }
      .gate-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 6px;
      }
      .gate-warning {
        color: #b00020;
        font-weight: 700;
        margin-top: 8px;
        display: none;
      }
      .gate-form.shake {
        animation: shake 0.35s;
      }
      @keyframes shake {
        10% {
          transform: translateX(-6px);
        }
        30% {
          transform: translateX(6px);
        }
        50% {
          transform: translateX(-4px);
        }
        70% {
          transform: translateX(4px);
        }
        90% {
          transform: translateX(-2px);
        }
        100% {
          transform: translateX(0);
        }
      }
    </style>
  </head>
  <body>
    <div id="gate" aria-modal="true" role="dialog">
      <form
        id="gateForm"
        class="gate-form"
        onsubmit="return handleGate(event);"
      >
        <h2>Who are you?</h2>
        <input
          id="guestName"
          name="guestName"
          type="text"
          placeholder="Name (e.g. Arundhathi)"
          required
          autocomplete="name"
        />
        <div id="nameFormatHint" class="gate-warning" style="display: none">
          Name should be <strong>Arundhathi</strong>.
        </div>
        <input
          id="guestDob"
          name="guestDob"
          type="tel"
          placeholder="DD-MM-YYYY or 2002"
          required
          autocomplete="bday"
          inputmode="text"
          pattern="(\d{4}|\d{1,2}[-\/\.\s]\d{1,2}[-\/\.\s]\d{4})"
        />
        <div id="dobFormatHint" class="gate-warning" style="display: none">
          Enter year (e.g. <strong>2002</strong>) or full DOB
          <strong>dd-mm-yyyy</strong>.
        </div>
        <div class="gate-actions">
          <button type="submit" class="yes">Enter</button>
          <button type="button" class="no" id="resetGate">Clear</button>
        </div>
        <div class="gate-warning" id="gateWarning" role="alert">
          You are not the girl I'm trying.
        </div>
      </form>
    </div>

    <div class="card">
      <h1>Ammu</h1>
      <p>Happy Valentine's Day, Ammu üíñ</p>

      <div class="buttons">
        <button class="yes" onclick="sayYes()">Yes üíñ</button>
        <button class="no" id="noBtn">No üò¢</button>
      </div>

      <div class="success" id="successMsg">
        You made me the happiest person alive, Ammu! üíç‚ù§Ô∏è
      </div>
    </div>

    <script>
      // --- Entry gate logic ---
      const gate = document.getElementById("gate");
      const gateForm = document.getElementById("gateForm");
      const gateWarning = document.getElementById("gateWarning");
      const nameInput = document.getElementById("guestName");
      const nameFormatHint = document.getElementById("nameFormatHint");
      const dobInput = document.getElementById("guestDob");
      const dobFormatHint = document.getElementById("dobFormatHint");
      const resetGateBtn = document.getElementById("resetGate");
      const CARD = document.querySelector(".card");

      const CORRECT_NAME = "arundhathi";
      const CORRECT_YEAR = 2002; // only birth year required (2002)

      function normalizeName(n) {
        return (n || "").trim().toLowerCase().replace(/\s+/g, " ");
      }
      // Returns normalized 'dd-mm-yyyy' or null when input cannot be interpreted as a valid date
      function normalizeDob(s) {
        s = (s || "").trim();
        if (!s) return null;
        // accept d/m/yyyy, d-m-yyyy, d.m.yyyy
        const m = s.match(/^(\d{1,2})[\/\-\.\s](\d{1,2})[\/\-\.\s](\d{4})$/);
        if (m) {
          const d = String(m[1]).padStart(2, "0");
          const mo = String(m[2]).padStart(2, "0");
          const y = m[3];
          const date = new Date(`${y}-${mo}-${d}`);
          if (
            !isNaN(date) &&
            date.getFullYear() === parseInt(y, 10) &&
            date.getMonth() === parseInt(mo, 10) - 1 &&
            date.getDate() === parseInt(d, 10)
          ) {
            return `${d}-${mo}-${y}`;
          }
          return null;
        }
        // ISO-style yyyy-mm-dd
        const iso = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if (iso) {
          const [_, y, mo, d] = iso;
          const date = new Date(`${y}-${mo}-${d}`);
          if (!isNaN(date)) return `${d}-${mo}-${y}`;
          return null;
        }
        // last resort: use Date parser then format
        const parsed = new Date(s);
        if (!isNaN(parsed)) {
          const d = String(parsed.getDate()).padStart(2, "0");
          const mo = String(parsed.getMonth() + 1).padStart(2, "0");
          const y = parsed.getFullYear();
          return `${d}-${mo}-${y}`;
        }
        return null;
      }

      function showGateWarning() {
        gateWarning.style.display = "block";
        gateForm.classList.add("shake");
        setTimeout(() => gateForm.classList.remove("shake"), 400);
      }
      function clearGateWarning() {
        gateWarning.style.display = "none";
      }

      function unlock() {
        gate.style.display = "none";
        CARD.removeAttribute("aria-hidden");
        localStorage.setItem("valentine_unlocked", "1");
        document.querySelector(".yes").focus();
      }

      function handleGate(e) {
        e.preventDefault();
        clearGateWarning();
        nameFormatHint.style.display = "none";
        dobFormatHint.style.display = "none";

        const name = normalizeName(nameInput.value);
        if (!name) {
          nameFormatHint.textContent = "Please enter a name.";
          nameFormatHint.style.display = "block";
          gateForm.classList.add("shake");
          setTimeout(() => gateForm.classList.remove("shake"), 400);
          return false;
        }
        if (name !== CORRECT_NAME) {
          nameFormatHint.textContent = "Name does not match.";
          nameFormatHint.style.display = "block";
          gateForm.classList.add("shake");
          setTimeout(() => gateForm.classList.remove("shake"), 400);
          return false;
        }

        const dobNorm = normalizeDob(dobInput.value);
        if (!dobNorm) {
          dobFormatHint.style.display = "block";
          gateForm.classList.add("shake");
          setTimeout(() => gateForm.classList.remove("shake"), 400);
          return false;
        }

        // accept if birth year matches CORRECT_YEAR (input may be full DOB or just year)
        const dobYear = dobNorm.split("-")[2];
        if (parseInt(dobYear, 10) !== CORRECT_YEAR) {
          gateWarning.textContent = "You are not the girl I'm trying.";
          gateWarning.style.display = "block";
          gateForm.classList.add("shake");
          setTimeout(() => gateForm.classList.remove("shake"), 400);
          return false;
        }

        unlock();
        return false;
      }

      resetGateBtn.addEventListener("click", () => {
        nameInput.value = "";
        dobInput.value = "";
        clearGateWarning();
        nameFormatHint.style.display = "none";
        dobFormatHint.style.display = "none";
        nameInput.focus();
      });

      // real-time validation for inputs
      nameInput.addEventListener("input", () => {
        const n = normalizeName(nameInput.value);
        if (!n) {
          nameFormatHint.textContent = "Please enter a name.";
          nameFormatHint.style.display = "block";
          return;
        }
        if (n !== CORRECT_NAME) {
          nameFormatHint.textContent = "Name does not match.";
          nameFormatHint.style.display = "block";
          return;
        }
        nameFormatHint.style.display = "none";
        clearGateWarning();
      });

      dobInput.addEventListener("input", () => {
        const dn = normalizeDob(dobInput.value);
        if (!dobInput.value.trim()) {
          dobFormatHint.style.display = "none";
          return;
        }
        if (!dn) {
          dobFormatHint.style.display = "block";
        } else {
          dobFormatHint.style.display = "none";
          clearGateWarning();
        }
      });

      // persist unlock on this device (optional)
      if (localStorage.getItem("valentine_unlocked") === "1") {
        gate.style.display = "none";
      } else {
        CARD.setAttribute("aria-hidden", "true");
        nameInput.focus();
      }

      // --- existing interactive behavior (no button, hearts) ---
      const noBtn = document.getElementById("noBtn");
      const isTouch =
        (window.matchMedia && window.matchMedia("(pointer: coarse)").matches) ||
        "ontouchstart" in window;

      // Evasive behavior ‚Äî works on desktop and touch devices (touch behavior is constrained and mobile-friendly)
      const moveNoBtn = (event) => {
        if (noBtn.disabled) return;
        const padding = 12;
        const maxX = Math.max(
          0,
          window.innerWidth - noBtn.offsetWidth - padding,
        );
        const maxY = Math.max(
          0,
          window.innerHeight - noBtn.offsetHeight - padding,
        );

        let x = Math.random() * maxX;
        let y = Math.random() * maxY;

        const rect = noBtn.getBoundingClientRect();
        if (Math.hypot(rect.left - x, rect.top - y) < 80) {
          x = (x + rect.left + 120) % Math.max(1, maxX);
          y = (y + rect.top + 120) % Math.max(1, maxY);
        }

        // For touch devices, keep movement inside the card area and make button smaller so it can move
        if (isTouch) {
          const cardRect = CARD.getBoundingClientRect();
          const areaLeft = Math.max(8, cardRect.left - 20);
          const areaRight = Math.min(
            window.innerWidth - noBtn.offsetWidth - 8,
            cardRect.right + 20,
          );
          const areaTop = Math.max(8, cardRect.top - 20);
          const areaBottom = Math.min(
            window.innerHeight - noBtn.offsetHeight - 8,
            cardRect.bottom + 20,
          );

          x = areaLeft + Math.random() * Math.max(0, areaRight - areaLeft);
          y = areaTop + Math.random() * Math.max(0, areaBottom - areaTop);

          noBtn.classList.add("movable");
          noBtn.style.minWidth = "110px";
        } else {
          noBtn.classList.remove("movable");
          noBtn.style.minWidth = "";
        }

        noBtn.style.position = "fixed";
        noBtn.style.left = Math.max(8, Math.min(x, maxX)) + "px";
        noBtn.style.top = Math.max(8, Math.min(y, maxY)) + "px";

        // tiny pop feedback
        noBtn.style.transform = "scale(1.05)";
        setTimeout(() => (noBtn.style.transform = ""), 120);

        if (event && typeof event.preventDefault === "function") {
          event.preventDefault();
          event.stopPropagation();
        }
      };

      if (!isTouch) {
        noBtn.addEventListener("pointerenter", moveNoBtn);
        noBtn.addEventListener("mousedown", moveNoBtn);
        noBtn.addEventListener("click", (e) => {
          // disable buttons when user successfully clicks No
          disableCardButtons();
          if (!noBtn.disabled) moveNoBtn(e);
        });
        noBtn.addEventListener("focus", moveNoBtn);
        noBtn.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            disableCardButtons();
            if (!noBtn.disabled) moveNoBtn(e);
          }
        });
      } else {
        // mobile: move on touchstart/click but keep buttons stacked initially
        noBtn.addEventListener(
          "touchstart",
          (e) => {
            if (noBtn.disabled) return;
            moveNoBtn(e);
          },
          {
            passive: false,
          },
        );
        noBtn.addEventListener("click", (e) => {
          disableCardButtons();
          if (!noBtn.disabled) moveNoBtn(e);
        });
        // keep initial layout but allow floating after first attempt
        noBtn.style.position = "static";
        noBtn.style.width = "100%";
      }

      function disableCardButtons() {
        // hide the buttons container and mark buttons disabled for accessibility
        const buttonsContainer = document.querySelector(".card .buttons");
        if (buttonsContainer) {
          buttonsContainer.style.display = "none";
          buttonsContainer.setAttribute("aria-hidden", "true");
        }

        const cardYesBtn = document.querySelector(".card .yes");
        if (cardYesBtn) {
          cardYesBtn.disabled = true;
          cardYesBtn.style.display = "none";
        }

        if (noBtn) {
          noBtn.disabled = true;
          noBtn.style.transform = "";
          noBtn.style.display = "none";
          noBtn.setAttribute("aria-hidden", "true");
        }
      }

      function sayYes() {
        disableCardButtons();
        document.getElementById("successMsg").style.display = "block";
        createHearts();
      }

      function createHearts() {
        const count = window.innerWidth < 480 ? 12 : 30;
        for (let i = 0; i < count; i++) {
          const heart = document.createElement("div");
          heart.className = "heart";
          heart.innerHTML = "‚ù§Ô∏è";
          const left = Math.random() * Math.max(0, window.innerWidth - 40);
          heart.style.left = left + "px";
          heart.style.top = window.innerHeight + "px";
          heart.style.animationDuration = Math.random() * 2 + 3 + "s";
          document.body.appendChild(heart);
          setTimeout(() => heart.remove(), 5000);
        }
      }
    </script>
  </body>
</html>
